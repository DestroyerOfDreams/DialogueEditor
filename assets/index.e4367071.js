var Se=Object.defineProperty,qe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ue=(e,t,s)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,B=(e,t)=>{for(var s in t||(t={}))we.call(t,s)&&ue(e,s,t[s]);if(ce)for(var s of ce(t))Ee.call(t,s)&&ue(e,s,t[s]);return e},M=(e,t)=>qe(e,ke(t));import{d as j,o as d,c,a as n,b as ne,F as Te,r as V,D as ge,w as Ie,e as De,f as w,g as _e,h as O,i as U,n as pe,u as x,t as ee,j as I,k as te,v as ve,p as ae,l as le,C as J,m as Y,q as Ae,s as Pe,R as He,x as he,y as Le,L as Qe,z as Fe,A as Ve}from"./vendor.efb71237.js";const Oe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerpolicy&&(u.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?u.credentials="include":l.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}};Oe();class ye{constructor(t,s){this.text=t,this.solvesQuest=s}}class Re{constructor(t,s,a,l,u,g){this.name=t,this.playerType=s,this.texts=a,this.useSocialActions=u,this.triggers=l,this.questId=g}}class Be{constructor(t,s){this.x=t,this.y=s}}class Me{constructor(t,s,a,l,u){this.id=t,this.position=s,this.type=a,this.class=l,this.data=u}}class Ue{constructor(t,s,a,l,u){this.id=t,this.source=s,this.target=a,this.sourceHandle=l,this.targetHandle=u}}class me{}var se=(e,t)=>{const s=e.__vccOpts||e;for(const[a,l]of t)s[a]=l;return s};const je={class:"save__controls"},ze={class:"btn"},Je=ne(" Load scenario "),Ye={inheritAttrs:!1,methods:{onFileChange(e){let t=e.target.files;t==null||!t.length||this.doSomethingWithTheFile(t[0])},onSave(){let e=prompt("Define your file name.");if(this.$props.scenario!=null){let s=JSON.parse(JSON.stringify(this.$props.scenario));s.conversations.forEach(a=>{a.nodes.forEach(l=>{l.type=="playerNode"&&delete l.data.quests})}),s.quests.forEach(a=>{delete a.solved});var t=new Blob([JSON.stringify(s)],{type:"application/json"});Te.exports.saveAs(t,e)}},doSomethingWithTheFile(e){let t=new FileReader;t.onload=s=>{if(s.target!=null){let a=JSON.parse(String(s.target.result));console.log(a),this.$emit("json-file-loaded",a)}},t.readAsText(e)}},props:{scenario:me}},We=j(M(B({},Ye),{setup(e){return(t,s)=>(d(),c("div",je,[n("label",{class:"btn",onClick:s[0]||(s[0]=(...a)=>t.onSave&&t.onSave(...a))},"Save scenario"),n("label",ze,[n("input",{id:"hiddenInput",type:"file",onChange:s[1]||(s[1]=(...a)=>t.onFileChange&&t.onFileChange(...a))},null,32),Je])]))}}));var Xe=se(We,[["__scopeId","data-v-17ac6740"]]);const fe=V(new Map);function xe(){function e(t,...s){fe.value.set(t,s)}return{emit:e,bus:fe}}const E=e=>(ae("data-v-d9547880"),e=e(),le(),e),Ke={class:"hidemenu"},Ge={key:0},Ze=E(()=>n("div",{class:"description"},"Here you can select the dialogs from this scenario",-1)),et=E(()=>n("hr",null,null,-1)),tt=["onClick"],st={key:1},ot=E(()=>n("div",{class:"description"},"Here you can see and edit the quests for the scenario",-1)),nt=E(()=>n("hr",null,null,-1)),at=["onUpdate:modelValue"],lt={key:2},it=E(()=>n("div",{class:"description"},"Here you can see and edit the briefing for the scenario",-1)),rt=E(()=>n("hr",null,null,-1)),dt={class:"sidemenu"},ct={key:0},ut=E(()=>n("div",{class:"description"},"You can drag these nodes to the pane.",-1)),pt=E(()=>n("hr",null,null,-1)),vt=E(()=>n("div",{class:"description"},"Player Nodes",-1)),ht=E(()=>n("hr",null,null,-1)),ft=E(()=>n("div",{class:"description"},"NPC Nodes",-1)),gt=["onDragstart"],_t=j({props:{scenario:me},emits:["dialogSelected"],setup(e,{expose:t,emit:s}){const a=e,{nodes:l,edges:u,addNodes:g,setNodes:D,setEdges:F,instance:C,dimensions:S}=ge(),_=(h,p,P,o)=>{h.dataTransfer&&(h.dataTransfer.setData("application/vueflow",p),h.dataTransfer.setData("application/nodeClass",P),h.dataTransfer.setData("application/npcName",o),h.dataTransfer.effectAllowed="move")};let y=null,$=V(null);V(null),t({reset:()=>{y=null,$.value=null,D([]),F([])}});const re=(h,p)=>{console.log($),y=h,$.value=p,s("dialogSelected",p),D(h.nodes),F(h.edges)},X=()=>{var h;if(y!=null){let p=prompt("Please enter the new NPC name","");(h=y.actors)==null||h.push(p)}},oe=()=>{var h;if(a.scenario!=null){let p={id:(h=a.scenario)==null?void 0:h.quests.length,navigationPoint:{x:0,y:0,z:0},quest:"",questType:0};a.scenario.quests.push(p)}},{bus:m}=xe(),R=new Map;return Ie(()=>m.value.get("questChange"),h=>{var p,P,o;R.clear(),(p=a.scenario)==null||p.conversations.forEach(v=>{v.nodes.forEach(T=>{let K=!1;T.data.texts.forEach(G=>{G.solvesQuest&&(K=!0,console.log(T))}),K&&R.set(T.data.questId,!0)})}),console.log(R),console.log((P=a.scenario)==null?void 0:P.quests),(o=a.scenario)==null||o.quests.forEach(v=>{R.get(v.id)==!0?v.solved=!0:v.solved=!1})}),(h,p)=>{const P=De("container");return d(),c(O,null,[n("div",Ke,[w(P,null,{default:_e(()=>[e.scenario!=null?(d(),c("aside",Ge,[Ze,et,(d(!0),c(O,null,U(e.scenario.conversations,(o,v)=>(d(),c("div",{key:v,class:pe(["vue-flow__node-default",{active:v===x($)}]),onClick:T=>re(o,v)}," Dialog "+ee(v),11,tt))),128))])):I("",!0),e.scenario!=null?(d(),c("aside",st,[ot,nt,(d(!0),c(O,null,U(e.scenario.quests,(o,v)=>(d(),c("div",{key:v},[e.scenario.quests[v].questType==0?te((d(),c("textarea",{key:0,name:"quest","onUpdate:modelValue":T=>e.scenario.quests[v].quest=T,rows:"",class:pe({solved:e.scenario.quests[v].solved==!0})},null,10,at)),[[ve,e.scenario.quests[v].quest]]):I("",!0)]))),128)),n("button",{onClick:oe},"Add Quest")])):I("",!0),e.scenario!=null?(d(),c("aside",lt,[it,rt,te(n("textarea",{name:"briefing",id:"briefing","onUpdate:modelValue":p[0]||(p[0]=o=>e.scenario.briefing=o),rows:"10"},null,512),[[ve,e.scenario.briefing]])])):I("",!0)]),_:1})]),n("div",dt,[x($)!=null?(d(),c("aside",ct,[ut,pt,vt,n("div",{class:"vue-flow__node-default player1",draggable:!0,onDragstart:p[1]||(p[1]=o=>_(o,"playerNode","player1"))}," Player1 Node ",32),n("div",{class:"vue-flow__node-default player2",draggable:!0,onDragstart:p[2]||(p[2]=o=>_(o,"playerNode","player2"))}," Player2 Node ",32),n("div",{class:"vue-flow__node-default playerAll",draggable:!0,onDragstart:p[3]||(p[3]=o=>_(o,"playerNode","playerAll"))}," All Players Node ",32),ht,ft,(d(!0),c(O,null,U(e.scenario.conversations[x($)].actors,(o,v)=>(d(),c("div",{key:v,class:"vue-flow__node-default npc",draggable:!0,onDragstart:T=>_(T,"npcNode","npc",o)},ee(o),41,gt))),128)),n("button",{onClick:X},"Add NPC")])):I("",!0)])],64)}}});var yt=se(_t,[["__scopeId","data-v-d9547880"]]);const ie=e=>(ae("data-v-1550e24b"),e=e(),le(),e),mt={style:{position:"relative"}},xt=ne(" NPC - "),Nt=ie(()=>n("hr",null,null,-1)),Ct=ie(()=>n("div",null," Responses: ",-1)),$t={id:"texts-npcs"},bt=["value","onInput"],St=["onClick"],qt=ie(()=>n("br",null,null,-1)),kt={key:0,class:"footer"},wt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Et=j(M(B({},wt),{props:{id:null,data:null},setup(e){const t=e,s={background:"#555",position:"absolute",top:"20px"};M(B({},s),{position:"relative",left:"15px",top:"0px",transform:"0"});const a=()=>{let g=new ye("",!1);t.data.texts.push(g)},l=(g,D)=>{t.data.texts[D].text=g.target.value},u=g=>{t.data.texts.splice(g,1)};return(g,D)=>(d(),c("div",mt,[w(x(Y),{type:"target",id:"gi1",position:x(J).Left,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(x(Y),{type:"source",id:"go1",position:x(J).Right,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),n("div",null,[xt,n("strong",null,ee(e.data.name),1)]),Nt,Ct,n("ul",$t,[(d(!0),c(O,null,U(e.data.texts,(F,C)=>(d(),c("li",{key:C,style:{position:"relative"}},[n("textarea",{class:"nodrag",value:e.data.texts[C].text,onInput:S=>l(S,C),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,bt),n("span",{onClick:S=>u(C)},"x",8,St)]))),128))]),qt,n("button",{onClick:a},"Add text"),t.data.fullfilsQuest?(d(),c("div",kt,"Fullfils Quest")):I("",!0)]))}}));var Tt=se(Et,[["__scopeId","data-v-1550e24b"]]);const W=e=>(ae("data-v-26c92e8d"),e=e(),le(),e),It={style:{position:"relative"}},Dt={key:0},At={key:1},Pt={key:2},Ht=W(()=>n("hr",null,null,-1)),Lt=W(()=>n("div",null," Responses: ",-1)),Qt={id:"texts-npcs"},Ft=["onUpdate:modelValue","onChange"],Vt=["value","onInput"],Ot=["onClick"],Rt=W(()=>n("br",null,null,-1)),Bt=W(()=>n("hr",null,null,-1)),Mt=ne(" Quest: "),Ut=W(()=>n("option",{value:"-1"},"None",-1)),jt=["value"],zt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Jt=j(M(B({},zt),{props:{id:null,data:null},setup(e){const t=e,{emit:s}=xe(),a={background:"#555",position:"absolute",top:"20px"},l=M(B({},a),{position:"relative",left:"15px",top:"0px",transform:"0"}),u=()=>{let C=new ye("",!1);t.data.texts.push(C)},g=(C,S)=>{t.data.texts[S].text=C.target.value},D=C=>{t.data.texts.splice(C,1)},F=C=>{let S=!1;t.data.texts.forEach((y,$)=>{y.solvesQuest&&(S=!0)});let _={isSolved:S,questId:t.data.questId};s("questChange",_)};return(C,S)=>(d(),c("div",It,[w(x(Y),{type:"target",id:"gi1",position:x(J).Left,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(x(Y),{type:"source",id:"go1",position:x(J).Right,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),n("div",null,[t.data.playerType=="player1"?(d(),c("strong",Dt,"Player 1")):I("",!0),t.data.playerType=="player2"?(d(),c("strong",At,"Player 2")):I("",!0),t.data.playerType=="playerAll"?(d(),c("strong",Pt,"All Players")):I("",!0)]),Ht,Lt,n("ul",Qt,[(d(!0),c(O,null,U(e.data.texts,(_,y)=>(d(),c("li",{key:y,style:{position:"relative"}},[e.data.questId!=-1?te((d(),c("input",{key:0,type:"checkbox","onUpdate:modelValue":$=>e.data.texts[y].solvesQuest=$,onChange:$=>F()},null,40,Ft)),[[Pe,e.data.texts[y].solvesQuest]]):I("",!0),n("textarea",{class:"nodrag",value:e.data.texts[y].text,onInput:$=>g($,y),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Vt),w(x(Y),{id:"p"+y,type:"source",position:x(J).Right,style:l},null,8,["id","position"]),n("span",{onClick:$=>D(y)},"x",8,Ot)]))),128))]),Rt,n("button",{onClick:u},"Add response"),Bt,n("div",null,[Mt,te(n("select",{"onUpdate:modelValue":S[0]||(S[0]=_=>e.data.questId=_),style:{"max-width":"170px"}},[Ut,(d(!0),c(O,null,U(e.data.quests.filter(_=>_.questType==0),_=>(d(),c("option",{value:_.id,key:_.id},[n("span",null,ee(_.quest),1)],8,jt))),128))],512),[[Ae,e.data.questId]])])]))}}));var Yt=se(Jt,[["__scopeId","data-v-26c92e8d"]]);const Wt=j({setup(e){const t=[],{setTransform:s}=He(),{instance:a,onConnect:l,nodes:u,edges:g,addEdges:D,addNodes:F,setNodes:C,setEdges:S,onEdgesChange:_,onNodesChange:y,setTranslateExtent:$,setState:Ne,store:re}=ge();let X=0;const oe=()=>`node${X++}`;let m=V(null);y(i=>{g.value.forEach(r=>{delete r.selected}),i.forEach(r=>{var f,q;if(o.value!=null&&m.value!=null){if(r.type==="position"){let b=o.value.conversations[m.value].nodes.findIndex(function(k){return k.id==r.id});b>=0&&(o.value.conversations[m.value].nodes[b].position.x=(f=r.position)==null?void 0:f.x,o.value.conversations[m.value].nodes[b].position.y=(q=r.position)==null?void 0:q.y)}else if(r.type==="remove"){let b=o.value.conversations[m.value].nodes.findIndex(function(k){return k.id==r.id});o.value.conversations[m.value].nodes.splice(b,1)}}})}),_(i=>{u.value.forEach(r=>{delete r.selected}),i.forEach(r=>{if(r.type==="remove"&&o.value!=null&&m.value!=null){let f=o.value.conversations[m.value].edges.findIndex(function(q){return q.id==r.id});o.value.conversations[m.value].edges.splice(f,1)}})}),l(i=>{if(D([i]),o.value!=null&&m.value!=null){let r="edge-"+i.source+i.sourceHandle+"-"+i.target+i.targetHandle;o.value.conversations[m.value].edges.push(new Ue(r,i.source,i.target,i.sourceHandle,i.targetHandle))}});const R=i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move")},h=i=>{},p=i=>{var r,f,q,b,k,H;if(a.value){const L=oe(),N=[],A=[],Q=-1,z=(r=i.dataTransfer)==null?void 0:r.getData("application/vueflow"),Z=(f=i.dataTransfer)==null?void 0:f.getData("application/nodeClass"),de=(q=i.dataTransfer)==null?void 0:q.getData("application/npcName"),Ce=a.value.project({x:i.clientX,y:i.clientY-40}),$e={id:L,type:z,class:Z,data:{onChange:h,onConnect:l,name:de,texts:N,playerType:Z,questId:Q,quests:(b=o.value)==null?void 0:b.quests},connectable:!0,position:Ce,label:`${z} node`};F([$e]),console.log("QYESTS"),console.log((k=o.value)==null?void 0:k.quests);let be=new Me(L,new Be(i.clientX,i.clientY-40),z,Z,new Re(de,Z,N,A,!1,Q));(H=o.value)==null||H.conversations[m.value].nodes.push(be)}},P={npcNode:he(Tt),playerNode:he(Yt)},o=V(null),v=V(null),T=i=>{var f,q,b,k,H,L;o.value=null,o.value=i,(f=o.value)==null||f.conversations.forEach(N=>{N.nodes.forEach(A=>{var Q;A.type=="playerNode"&&(A.data.quests=(Q=o.value)==null?void 0:Q.quests)})}),(q=o.value)==null||q.quests.forEach(N=>{N.solved=!1});const r=new Map;(b=o.value)==null||b.conversations.forEach(N=>{N.nodes.forEach(A=>{let Q=!1;A.data.texts.forEach(z=>{z.solvesQuest&&(Q=!0,console.log(A))}),Q&&r.set(A.data.questId,!0)})}),console.log(r),(k=o.value)==null||k.quests.forEach(N=>{r.get(N.id)==!0?N.solved=!0:(console.log("NOT NOT"),N.solved=!1)}),console.log((H=o.value)==null?void 0:H.quests),m.value=null,(L=v.value)==null||L.reset()},K=i=>{var k,H,L;m.value=i;let r=0;(k=o.value)==null||k.conversations[i].nodes.forEach((N,A)=>{Number(N.id.substring(4))>r,r=Number(N.id.substring(4))}),X=r+1;const f=(H=o.value)==null?void 0:H.conversations[i].nodes[0],q=Number(f==null?void 0:f.position.x),b=Number((L=f==null?void 0:f.position)==null?void 0:L.y);s({x:q+200||0,y:b+200||0,zoom:1})},G=V(t);return(i,r)=>(d(),c("div",{class:"dndflow",onDrop:p},[w(x(Le),{modelValue:G.value,"onUpdate:modelValue":r[0]||(r[0]=f=>G.value=f),onDragover:R,"node-types":P},{default:_e(()=>[w(x(Qe),{variant:x(Fe).Lines,"pattern-color":"#4d4d4d",gap:"25"},null,8,["variant"]),w(Xe,{scenario:o.value,onJsonFileLoaded:T},null,8,["scenario"]),w(yt,{scenario:o.value,onDialogSelected:K,ref_key:"sideBar",ref:v},null,8,["scenario"])]),_:1},8,["modelValue"])],32))}});const Xt={style:{height:"100vh"}},Kt=j({setup(e){return(t,s)=>(d(),c("div",Xt,[w(Wt)]))}});Ve(Kt).mount("#app");
